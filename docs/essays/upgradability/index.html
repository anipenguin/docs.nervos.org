<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-essays/upgradability">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CPNK56S8G3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CPNK56S8G3",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Nervos CKB" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&display=swap">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/js/extra.js"></script><title data-rh="true">Upgradable CKB Contracts—Why And How | Nervos CKB</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.nervos.org/img/undraw_online.svg"><meta data-rh="true" name="twitter:image" content="https://docs.nervos.org/img/undraw_online.svg"><meta data-rh="true" property="og:url" content="https://docs.nervos.org/docs/essays/upgradability"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Upgradable CKB Contracts—Why And How | Nervos CKB"><meta data-rh="true" name="description" content="In the blockchain space, there&#x27;s a pair of issues that everyone has to pick sides: upgradability vs determinism."><meta data-rh="true" property="og:description" content="In the blockchain space, there&#x27;s a pair of issues that everyone has to pick sides: upgradability vs determinism."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.nervos.org/docs/essays/upgradability"><link data-rh="true" rel="alternate" href="https://docs.nervos.org/docs/essays/upgradability" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.nervos.org/docs/essays/upgradability" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://LU9B8PQ7W5-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.88793b4f.css">
<link rel="preload" href="/assets/js/runtime~main.8e6520e5.js" as="script">
<link rel="preload" href="/assets/js/main.3cce6269.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Nervos CKB" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Nervos CKB" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/basics/introduction">Basics</a><a class="navbar__item navbar__link" href="/docs/reference/introduction">Reference</a><a class="navbar__item navbar__link" href="/docs/labs/introduction">Labs</a><a class="navbar__item navbar__link" href="/docs/integrate/introduction">Integrate</a><a class="navbar__item navbar__link" href="/docs/essays/introduction">Essays</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/developer-materials-guide">Developer Materials Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/rfcs">A Tour of RFCs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/lifecycle">Transaction Validation Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/debug">Tips for Debugging CKB Script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/pprof">Tips for Profiling CKB Script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/rules">CKB VM Verification Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/dependencies">Script Dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/polyjuice">Technical Bits on Polyjuice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/faq">CKB FAQs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/ckb-core-dev">Tips for CKB Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/integrity-check">Integrity Check for CKB Release</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/mint-sudt-via-contract">Mint SUDT via Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/pw-lock">Introduction of PW-lock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/tx-pool">Transaction Pool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/essays/tx-confirmation">The Back-of-Envelope Calculation of the Transaction Confirmation Number</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/essays/upgradability">Upgradable CKB Contracts—Why And How</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Upgradable CKB Contracts—Why And How</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgradable CKB Contracts—Why And How</h1></header><p>In the blockchain space, there&#x27;s a pair of issues that everyone has to pick sides: upgradability vs determinism.</p><p><strong>Upgradability</strong></p><p>Can I upgrade a smart contract after it&#x27;s deployed on the blockchain? </p><p>Suppose a smart contract gets widely adopted, then all of a sudden, someone notices a bug in the smart contract (sadly this will always happen in our industry). Can we upgrade the smart contract to the fixed state without any user interventions?</p><p>Or, a different scenario: as technology advances, there might be new algorithms that make smart contracts run faster. Can we upgrade existing smart contracts with those benefits?</p><p><strong>Determinism</strong></p><p>This one has two aspects:</p><ul><li>Determinism A: if I pick a smart contract to guard my tokens, will my tokens stay safe (could be unlocked by me and only by me) in the future?</li><li>Determinism B: if I sign a transaction now, and send it later, will my transaction still be accepted by the blockchain?</li></ul><p>Note that a secure blockchain has more deterministic requirements than those mentioned here. I&#x27;m only including properties that relate to the discussed problem here.</p><p><strong>Conflict</strong></p><p>If we think about it, we could find that there&#x27;re always conflicts between upgradability and determinism:</p><ul><li>New behaviors introduced through the upgradability of a smart contract can potentially lead to unexpected ways to unlock a cell, or preventing the owners from unlocking themselves.</li><li>An already signed transaction might run into different behaviors through the upgradability of a smart contract, resulting it being rejected by the blockchain.</li></ul><p>At first, some blockchains opt for determinism. <a href="https://www.harvardmagazine.com/2000/01/code-is-law-html" target="_blank" rel="noopener noreferrer">The &quot;code is law&quot; idea</a> thus became very famous in the blockchain space. But we all know that software design is all about tradeoffs. Given a certain situation, it makes sense to slightly sacrifice determinism, in exchange for the ease of upgradability. For example, when a vulnerability is discovered, everyone would expect their fund to be safe. Having upgradable contracts would equip developers the ability to deploy fixed contracts without any user intervention. Gradually, more blockchains have started to adopt the side of upgradability.</p><p>But the problem remains. Upgradable contracts break the &quot;code is law&quot; principle, meaning that a cell can be unlocked in unexpected ways that were not considered when it was created. So now the question is: can we ask for both in CKB?</p><p>It turns out CKB does have support for both via a special contract. It grants the user a choice to choose between upgradability and determinism. One can use an upgradable contract that can be upgraded automatically for new features/fixes, while also locking their most precious tokens in a cell that only they themselves can unlock.</p><p>But to understand this very contract in CKB, we have to first take a look at some other ideas that support this behavior.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="write-a-unique-type-script"><strong>Write A Unique Type Script</strong><a class="hash-link" href="#write-a-unique-type-script" title="Direct link to heading">​</a></h2><p>Let&#x27;s start with a different question: how do we create a cell with a unique <a href="https://docs.nervos.org/docs/basics/glossary#type-script" target="_blank" rel="noopener noreferrer">type script</a> data structure in CKB? In other words, we want to make sure that once a cell is created, no other cells can be created with the same type script.</p><p>Note that this question might seem irrelevant to script upgradability right now, but please bear with me, we will see later how it will contribute to the final solution in CKB.</p><p>It turns out that a special smart contract referenced via the type script of a cell, can perfectly validate the above requirement. I strongly recommend that you can give it a try first, to see how you would design such a cell. This can be a very good thought exercise. When you are ready, here&#x27;s the rough workflow for such a contract:</p><ol><li>Abort with a failure if more than one input cell in this transaction uses the current type script;</li><li>Abort with a failure if more than one output cell in this transaction uses the current type script;</li><li>When no input cells use the current type script, read the following two pieces of information:
a. The OutPoint data structure from the first input cell in this transaction;
b. The index of the first output cell using the current type script;</li><li>Hash the two pieces of information gathered in 3 together, if the resulting hash matches <code>args</code> part in current type script structure, return with success. Otherwise, abort with a failure.</li></ol><p>A <a href="https://github.com/nervosnetwork/ckb-c-stdlib/blob/b51f9b1b6221398c76c6bb78d63a430d93e791bf/ckb_type_id.h" target="_blank" rel="noopener noreferrer">C implementation</a> and a <a href="https://github.com/axonweb3/ckb-type-id/blob/bf59996428c75cb419bba0177de3e091b96fa64d/src/lib.rs" target="_blank" rel="noopener noreferrer">Rust</a> one are both available for this workflow.</p><p>Attackers will be prevented from several different directions:</p><ol><li>If an attacker tries to create a cell with the exactly same type script, there will be two cases:
a. A valid transaction will have different OutPoint data in the first input, or different output cell index from when we first created this cell;
b. If the user tries to duplicate type script args as the first transaction input, CKB will signal a double-spent error;</li><li>When the attacker tries to use a different type script args, it will be a different type script structure by definition.</li></ol><p>This way, we can ensure a cell will have unique type script across all live cells in CKB. Considering the fact that each type script structure can also be hashed, a cell in CKB can thus have a unique hash, or unique ID.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resolving-contracts-in-ckb-transaction"><strong>Resolving Contracts in CKB Transaction</strong><a class="hash-link" href="#resolving-contracts-in-ckb-transaction" title="Direct link to heading">​</a></h2><p>The above newly designed smart contract will act as the core for building upgradable smart contracts. What&#x27;s still missing here, is a clever use of CKB&#x27;s contract resolving process:</p><ul><li>CKB first extracts <code>code hash</code>, and <code>hash type</code> value from the lock/type script structure to run. To avoid ambiguity, we will denote <code>code hash</code> gathered here as <code>running code hash</code>, and <code>hash type</code> as <code>running hash type</code>.</li><li>For each dep cell in the current transaction, a <code>test hash</code> value will be calculated. Depending on the value of <code>running hash type</code>, there will be different ways to calculate <code>test hash</code>:<ul><li>If <code>running hash type</code> is <code>type</code>, <code>test hash</code> will be the hash of type script data structure from the dep cell;</li><li>Otherwise, <code>test hash</code> will be the hash of cell data part from the dep cell;</li></ul></li><li>CKB then looks for a dep cell whose <code>test hash</code> matches <code>running code hash</code>. In the absence of such a cell, CKB results in a validation error.</li><li>CKB uses the cell data from the located dep cell as the smart contract to run.</li></ul><p>Upgradability of smart contract has to do with ways to reference a changeable cell containing different smart contracts. In the upgrade process, the OutPoint structure for a cell will change (updating a cell is essentially destroying the old cell, then creating a new one), the cell data will also change (since we will need to store the fixed smart contract). Then what property can stay unchanged? In CKB&#x27;s universe, lock and type script can definitely stay the same when updating a cell. Since lock script is typically used to represent ownership, we can perfectly use type script here to reference an upgradable smart contract.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="putting-everything-together"><strong>Putting Everything Together</strong><a class="hash-link" href="#putting-everything-together" title="Direct link to heading">​</a></h2><p>There&#x27;s still one problem unsolved, a potential attack remains. Consider this:</p><ul><li>A lock script L1 is stored in a cell C1 with type script T1;</li><li>Alice guards her cells via a lock script L1 using <code>hash type</code> as <code>type</code>. By definition, she fills her script structure&#x27;s <code>code hash</code> field with the hash of type script T1;</li><li>Bob creates a different cell C2 with the always-success lock script L2, and also use the same type script T1;</li><li>Now Bob can use C2 as a dep cell to unlock Alice&#x27;s cell. CKB won&#x27;t be able to distinguish that Alice wants to use C1, while Bob provides C2. Both C1 and C2 use T1 as type script.</li></ul><p>That teaches us a very important lesson: if you build a lock/type script and want people to leverage the upgradability property, you have to make sure to use a cell with an unique and unforgeable type script in CKB universe.</p><p>Luckily, we just solved this problem! In the above we just developed a smart contract ensuring type script uniqueness in CKB universe. Putting together, upgradable smart contracts in CKB can be archived by combining the very smart contract developed above, with CKB&#x27;s ability to resolve contracts via type scripts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="trust-issue"><strong>Trust Issue</strong><a class="hash-link" href="#trust-issue" title="Direct link to heading">​</a></h2><p>We do want to mention that this design is not without its drawbacks. You should really understand how it works and the tradeoffs involved before using it. This section tries to discuss some known considerations related to this feature.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="determinism-property-a"><strong>Determinism Property A</strong><a class="hash-link" href="#determinism-property-a" title="Direct link to heading">​</a></h3><p>Type ID does provide a solution to challenges with regards to Determinism Property A: when a bug is discovered, it&#x27;s possible to fix the smart contracts without affecting existing cells using the same smart contracts. But it does require certain considerations.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ownership"><strong>Ownership</strong><a class="hash-link" href="#ownership" title="Direct link to heading">​</a></h4><p>With a type ID solution, people might be able to steal your coin by hacking the cell containing smart contracts you use. Since typical cells are guarded by one or more signatures, some human errors could cause major problems. Fundamentally, it&#x27;s a tradeoff situation:</p><ol><li>For those truly paranoid, they might want to stick to the old way of referencing a script via its own hash, not the type script hash of the containing cell. The &quot;code is law&quot; principle is fully enforced here. You will know exactly what can be used to unlock your cell, and it won&#x27;t change anytime in the future.</li><li>For people willing to sacrifice a little bit, they can gain the ability to upgrade existing smart contracts for different benefits. But please do make sure to fully understand the lock script of the cell containing the script you use.</li></ol><p>For example, if you look at the deployed system scripts in CKB&#x27;s mainnet, they all use type ID setup, but have all their lock scripts’ code hash set to zeros, meaning that no one gets to change the lock script easily via a signature. We want to make sure that there&#x27;s a need to change the default lock script, which will be realized via a fork agreed upon by the whole community. After all, IMHO, it really is the whole Nervos community that <em>owns</em> CKB :P</p><p>There are some initial ideas that you can use to guard the script contained in a cell. For example, in addition to type ID logic, the type script can also contains other logics to validate the actual script contained in its cell. For example, formal analysis methods might be used, or certain test cases can be provided in which the type script runs the actual script against. Only when the analysis or the test cases pass, will one be able to change script contained in a cell. Though I must say, these are just some preliminary ideas, much research and development work needs to be done to make this a reality.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="availability"><strong>Availability</strong><a class="hash-link" href="#availability" title="Direct link to heading">​</a></h4><p>A different issue with type ID, is the availability of the script. When you have a cell using a script with <code>hash type</code> set as <code>data</code>, you are not worried someone might destroy the used script, you can always redeploy the script on-chain then unlock your cell.</p><p>But with a type ID solution, if something bad happens, and the cell with matching type script hash is destroyed, your cell will be locked forever, since you might never be able to build a cell with the same type script hash. There are some methods you can use, such as restricting the ability to destroy a cell with a type ID script, but they all just mitigate the problem, not completely solving it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="determinism-property-b"><strong>Determinism Property B</strong><a class="hash-link" href="#determinism-property-b" title="Direct link to heading">​</a></h3><p>We do want to mention that type ID does not provide a solution to property B. When you have a signed transaction, the behavior of this transaction won&#x27;t be changed with the upgrade of one smart contract.</p><p>Though there is way that the type ID solution might affect an already signed transaction: If a transaction uses a script from a cell that gets updated, the cell referenced in the original OutPoint is already spent and the transaction will become invalid. But it could be argued that with the old referencing solution, this problem might also occur.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion"><strong>Conclusion</strong><a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>The above design of upgradable smart contracts has already seen wide usage in mainnet CKB now. Feel free to let us know your thoughts on this feature :)</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nervosnetwork/docs-new/tree/develop/website/docs/essays/upgradability.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/essays/tx-confirmation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The Back-of-Envelope Calculation of the Transaction Confirmation Number</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#write-a-unique-type-script" class="table-of-contents__link toc-highlight"><strong>Write A Unique Type Script</strong></a></li><li><a href="#resolving-contracts-in-ckb-transaction" class="table-of-contents__link toc-highlight"><strong>Resolving Contracts in CKB Transaction</strong></a></li><li><a href="#putting-everything-together" class="table-of-contents__link toc-highlight"><strong>Putting Everything Together</strong></a></li><li><a href="#trust-issue" class="table-of-contents__link toc-highlight"><strong>Trust Issue</strong></a><ul><li><a href="#determinism-property-a" class="table-of-contents__link toc-highlight"><strong>Determinism Property A</strong></a></li><li><a href="#determinism-property-b" class="table-of-contents__link toc-highlight"><strong>Determinism Property B</strong></a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight"><strong>Conclusion</strong></a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Foundation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developer</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0002-ckb/0002-ckb.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Whitepaper</a></li><li class="footer__item"><a href="https://github.com/nervosnetwork/rfcs" target="_blank" rel="noopener noreferrer" class="footer__link-item">RFCs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/AqGTUE9" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://talk.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://www.reddit.com/r/NervosNetwork/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit</a></li><li class="footer__item"><a href="https://t.me/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://medium.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCONuJGdMzUY0Y6jrPBOzH7A" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021  Nervos Foundation. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8e6520e5.js"></script>
<script src="/assets/js/main.3cce6269.js"></script>
</body>
</html>